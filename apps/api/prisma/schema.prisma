generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id               String                     @id @default(uuid())
  name             String
  email            String                     @unique
  password         String
  role             Role                       @default(SUPER_ADMIN)
  createdAt        DateTime                   @default(now())
  updatedAt        DateTime                   @updatedAt
  locationChanges  EquipmentLocationHistory[]
  statusChanges    EquipmentStatusHistory[]
  resolvedRequests PasswordResetRequest[]     @relation("ResolvedByAdmin")
}

model Faculty {
  id                    String                 @id @default(uuid())
  name                  String
  employeeId            String                 @unique
  password              String
  status                String                 @default("Active")
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  equipments            Equipment[]
  passwordResetRequests PasswordResetRequest[]
}

model PasswordResetRequest {
  id          String      @id @default(uuid())
  facultyId   String
  status      ResetStatus @default(PENDING)
  requestedAt DateTime    @default(now())
  resolvedAt  DateTime?
  resolvedBy  String?

  faculty         Faculty @relation(fields: [facultyId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  resolvedByAdmin User?   @relation("ResolvedByAdmin", fields: [resolvedBy], references: [id], onDelete: SetNull, onUpdate: Cascade)

  @@index([facultyId, status])
}

enum Role {
  SUPER_ADMIN
  USER
}

enum ResetStatus {
  PENDING
  COMPLETED
}

model Category {
  id          Int         @id @default(autoincrement())
  name        String      @unique
  description String?
  equipments  Equipment[]
}

model Room {
  id                 Int                        @id @default(autoincrement())
  name               String                     @unique
  building           String?
  floor              String?
  equipmentLocations EquipmentLocationHistory[]
}

model Equipment {
  id              Int                        @id @default(autoincrement())
  serialNumber    String                     @unique
  name            String
  categoryId      Int
  facultyId       String
  datePurchased   DateTime
  createdAt       DateTime                   @default(now())
  category        Category                   @relation(fields: [categoryId], references: [id], onUpdate: Cascade)
  faculty         Faculty                    @relation(fields: [facultyId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  locationHistory EquipmentLocationHistory[]
  statusHistory   EquipmentStatusHistory[]
}

model EquipmentStatusHistory {
  id          Int       @id @default(autoincrement())
  equipmentId Int
  status      String
  changedAt   DateTime  @default(now())
  changedById String?
  notes       String?
  changedBy   User?     @relation(fields: [changedById], references: [id], onDelete: SetNull, onUpdate: Cascade)
  equipment   Equipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model EquipmentLocationHistory {
  id           Int       @id @default(autoincrement())
  equipmentId  Int
  roomId       Int
  assignedAt   DateTime  @default(now())
  assignedById String?
  assignedBy   User?     @relation(fields: [assignedById], references: [id], onDelete: SetNull, onUpdate: Cascade)
  equipment    Equipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  room         Room      @relation(fields: [roomId], references: [id], onUpdate: Cascade)
}
